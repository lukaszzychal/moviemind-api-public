---
alwaysApply: true
---

# Workflow przed Commitem (WYMAGANE)

## Przed kaÅ¼dym commitem MUSISZ uruchomiÄ‡ i naprawiÄ‡:

### 1. Laravel Pint (formatowanie)
```bash
cd api && vendor/bin/pint
```

### 2. PHPStan (analiza statyczna)
```bash
cd api && vendor/bin/phpstan analyse --memory-limit=2G
```
Poziom: 5. Zero bÅ‚Ä™dÃ³w przed commitem.

#### Archiwizacja logÃ³w PHPStan
- Po kaÅ¼dym uruchomieniu PHPStan zapisz peÅ‚ny output (`stdout` + `stderr`) do pliku logÃ³w.
- UÅ¼ywaj katalogu `docs/logs/phpstan/` (utwÃ³rz przy pierwszym uÅ¼yciu, np. `mkdir -p docs/logs/phpstan`).
- Nazwa pliku: `phpstan-YYYYMMDD-HHMMSS.log` (np. `phpstan-20251109-153000.log`).
- Rekomendowane polecenie:
```bash
cd api && vendor/bin/phpstan analyse --memory-limit=2G 2>&1 | tee ../docs/logs/phpstan/phpstan-$(date +"%Y%m%d-%H%M%S").log
```
- Nie usuwaj istniejÄ…cych plikÃ³w logÃ³w â€” bÄ™dÄ… potrzebne w przyszÅ‚ych projektach.

### 3. PHPUnit (testy)
```bash
cd api && php artisan test
```
Wszystkie testy muszÄ… przechodziÄ‡.

### 4. GitLeaks (sekrety)
```bash
gitleaks protect --source . --verbose --no-banner
```
Zero wykrytych sekretÃ³w.

### 5. Composer Audit (bezpieczeÅ„stwo)
```bash
cd api && composer audit
```
Napraw krytyczne luki przed commitem.

### 6. Aktualizacja Dokumentacji API (jeÅ›li zmieniono endpointy)
**WAÅ»NE:** JeÅ›li dodano/zmieniono/usuniÄ™to endpointy API, **ZAWSZE** zaktualizuj:

#### OpenAPI Spec
```bash
# Zaktualizuj docs/openapi.yaml
# Dodaj/zmieÅ„/usuÅ„ endpointy zgodnie ze zmianami w kodzie
```

#### Postman Collection
```bash
# Zaktualizuj docs/postman/moviemind-api.postman_collection.json
# Dodaj/zmieÅ„/usuÅ„ requesty zgodnie ze zmianami w API
```

#### Insomnia Collection
```bash
# Zaktualizuj docs/insomnia/moviemind-api-insomnia.json
# Dodaj/zmieÅ„/usuÅ„ requesty zgodnie ze zmianami w API
```

**Kiedy aktualizowaÄ‡:**
- âœ… Dodano nowy endpoint
- âœ… Zmieniono Å›cieÅ¼kÄ™ endpointu
- âœ… Zmieniono parametry requestu/response
- âœ… UsuniÄ™to endpoint
- âœ… Zmieniono status codes
- âœ… Dodano/zmieniono autoryzacjÄ™

**Format aktualizacji:**
- OpenAPI: Zgodnie z formatem OpenAPI 3.0
- Postman: JSON format zgodny z Postman Collection v2.1
- Insomnia: JSON format zgodny z Insomnia Export

## Kompletny check (wszystko na raz)

```bash
cd api && \
  vendor/bin/pint && \
  vendor/bin/phpstan analyse --memory-limit=2G && \
  php artisan test && \
  gitleaks protect --source . --verbose --no-banner && \
  composer audit
```

**PamiÄ™taj:** Po zmianach w API zawsze zaktualizuj dokumentacjÄ™!

## Branch Workflow (domyÅ›lna zasada)

- **90% zadaÅ„** realizuj na krÃ³tkich branchach feature (`feature/â€¦`) obejmujÄ…cych jeden spÃ³jny temat.
- KaÅ¼dy branch koÅ„cz pull requestem do `main` (moÅ¼esz zatwierdziÄ‡ sam, ale PR i diff sÄ… obowiÄ…zkowe).
- `main` musi pozostaÄ‡ zawsze deployowalny; merguj tylko po przejÅ›ciu testÃ³w/pre-commitÃ³w.
- DÅ‚uÅ¼sze, wielotygodniowe branche stosuj wyÅ‚Ä…cznie w wyjÄ…tkowych rekonstrukcjach â€” wtedy dziel pracÄ™ na mniejsze PR-y.
- **Commit messages** pisz wyÅ‚Ä…cznie po angielsku, w stylu `type: short description` (np. `feat: add movie resource`). Niedozwolone sÄ… komunikaty w innych jÄ™zykach.
- Agent moÅ¼e wykonywaÄ‡ `git commit`, ale `git push` uruchamia wyÅ‚Ä…cznie na wyraÅºne polecenie uÅ¼ytkownika.

## Natychmiastowe commity

- Po kaÅ¼dej zmianie w plikach zasad Cursor (`.cursor/rules/*.mdc`) wykonaj natychmiastowy commit obejmujÄ…cy te pliki.
- Po dodaniu nowego zadania lub aktualizacji treÅ›ci istniejÄ…cego zadania w `docs/issue/**/*.md`, niezwÅ‚ocznie zatwierdÅº te zmiany w osobnym commicie.

## ZarzÄ…dzanie zadaniami (TASKS.md)

- Po rozpoczÄ™ciu zadania **zmieÅ„ status na `ğŸ”„ IN_PROGRESS`**, wpisz `Czas rozpoczÄ™cia` (z dokÅ‚adnoÅ›ciÄ… do minuty) oraz oznacz wykonawcÄ™ (`ğŸ¤–/ğŸ‘¨â€ğŸ’»/âš™ï¸`).
- Po zakoÅ„czeniu zadania:
  - uzupeÅ‚nij `Czas zakoÅ„czenia` oraz **oblicz `Czas realizacji`** (format `HHhMMm`), nawet gdy skrÃ³t mÃ³wi o AUTO,
  - zmieÅ„ status na `âœ… COMPLETED`,
  - **przenieÅ› caÅ‚y blok zadania do sekcji â€âœ… ZakoÅ„czone Zadaniaâ€**,
  - dopisz krÃ³tki opis wykonanych prac (np. lista kluczowych zmian).
- Nie zostawiaj ukoÅ„czonych zadaÅ„ w sekcji â€Aktywneâ€. Sekcja ta powinna zawieraÄ‡ wyÅ‚Ä…cznie zadania w statusie `â³` lub `ğŸ”„`.
- Po aktualizacji `TASKS.md` odpal workflow synchronizacji (push/merge do `main` lub rÄ™cznie w GitHub Actions), aby Issues byÅ‚y spÃ³jne.

## Dokumentacja (PL / EN)

- KaÅ¼dy dokument musi mieÄ‡ wersjÄ™ polskÄ… i angielskÄ… (np. w `docs/â€¦/pl` i `docs/â€¦/en`).
- Przy modyfikacji jednego jÄ™zyka **natychmiast** zaktualizuj drugi â€“ brak synchronizacji traktujemy jako bÅ‚Ä…d review.
- JeÅ›li treÅ›Ä‡ jest dÅ‚uga, dopuszczalne sÄ… streszczenia, ale oba jÄ™zyki muszÄ… zawieraÄ‡ komplet kluczowych informacji i linkowaÄ‡ do siebie.
- Pliki indeksowe (np. `docs/issue/README.md`) powinny jasno wskazywaÄ‡, gdzie znajdujÄ… siÄ™ wersje PL i EN.

## Linki zewnÄ™trzne i nazwy wÅ‚asne

- Przy podawaniu publicznie dostÄ™pnych nazw wÅ‚asnych (np. sklepy internetowe, dostawcy) **zawsze** doÅ‚Ä…cz obok wiarygodny link URL.
- KaÅ¼dy link zewnÄ™trzny **musisz zweryfikowaÄ‡** (otworzyÄ‡/testowo sprawdziÄ‡), aby upewniÄ‡ siÄ™, Å¼e jest aktywny i prowadzi do wÅ‚aÅ›ciwego ÅºrÃ³dÅ‚a.
- JeÅ›li nie moÅ¼esz potwierdziÄ‡ linku, **wyraÅºnie to zaznacz**, dodajÄ…c alternatywne ÅºrÃ³dÅ‚o lub ostrzeÅ¼enie.
- Odpowiedzi formatuj przejrzyÅ›cie (nagÅ‚Ã³wki, listy punktowane) zgodnie z guideline Cursor.

## Testowanie manualne

- **ZAWSZE** przetestuj manualnie taski i funkcje, ktÃ³re moÅ¼na przetestowaÄ‡ bez automatycznych testÃ³w.
- Przed zakoÅ„czeniem zadania zweryfikuj, Å¼e implementacja dziaÅ‚a poprawnie w praktyce (np. przez wywoÅ‚anie endpointu API, sprawdzenie odpowiedzi, weryfikacjÄ™ zachowania w przeglÄ…darce).
- JeÅ›li testowanie wymaga uruchomienia Dockera lub innego narzÄ™dzia (np. Redis, Horizon, PostgreSQL), **zawsze poinformuj uÅ¼ytkownika**:
  - Jakie narzÄ™dzie jest potrzebne
  - Jak je uruchomiÄ‡ (np. `docker compose up -d`, `php artisan horizon`)
  - Jakie komendy naleÅ¼y wykonaÄ‡ do weryfikacji
  - Gdzie sprawdziÄ‡ wyniki (logi, dashboard, etc.)
- PrzykÅ‚ady sytuacji wymagajÄ…cych testowania manualnego:
  - Nowe endpointy API (sprawdzenie odpowiedzi, status codes, format JSON)
  - Integracje z zewnÄ™trznymi serwisami (OpenAI, etc.)
  - Zmiany w UI/UX (jeÅ›li dotyczy)
  - FunkcjonalnoÅ›ci wymagajÄ…ce interakcji uÅ¼ytkownika
  - Scenariusze trudne do przetestowania automatycznie (np. race conditions, timing issues)
- JeÅ›li testowanie manualne nie jest moÅ¼liwe lub wymagaÅ‚oby zbyt duÅ¼o czasu, poinformuj uÅ¼ytkownika o tym i zaproponuj alternatywne podejÅ›cie (np. testy automatyczne, dokumentacja, etc.).

## Informowanie o modelu AI i tokenach

- **ZAWSZE** informuj uÅ¼ytkownika z jakiego modelu AI korzystasz na poczÄ…tku odpowiedzi lub gdy jest to istotne dla kontekstu.
- Format: `**Model AI uÅ¼ywany:** [nazwa modelu]` (np. `Claude Sonnet 4.5 (Auto)`, `OpenAI gpt-4o-mini`).
- JeÅ›li dostÄ™pne sÄ… informacje o tokenach (zuÅ¼yte/pozostaÅ‚e) i **ich podanie nie zuÅ¼ywa dodatkowych tokenÃ³w**, moÅ¼esz je doÅ‚Ä…czyÄ‡:
  - Format podstawowy: `**Tokeny:** zuÅ¼yte: X, pozostaÅ‚e: Y` (lub podobny, w zaleÅ¼noÅ›ci od dostÄ™pnych danych).
  - JeÅ›li dostÄ™pne sÄ… szczegÃ³Å‚owe informacje o tokenach dla prompt/response lub input/output, moÅ¼esz je podaÄ‡:
    - Format: `**Tokeny:** input: X, output: Y, total: Z` lub `**Tokeny:** prompt: X, response: Y, total: Z`
    - UwzglÄ™dnij tylko te informacje, ktÃ³re sÄ… dostÄ™pne i ktÃ³rych podanie nie zuÅ¼ywa dodatkowych tokenÃ³w.
- JeÅ›li informacja o tokenach nie jest dostÄ™pna lub jej podanie zuÅ¼ywaÅ‚oby dodatkowe tokeny, pomiÅ„ tÄ™ informacjÄ™.
- W kontekÅ›cie aplikacji MovieMind API, jeÅ›li wspominasz o modelu uÅ¼ywanym przez aplikacjÄ™ (np. OpenAI), zawsze podaj peÅ‚nÄ… nazwÄ™ modelu (np. `gpt-4o-mini`).
