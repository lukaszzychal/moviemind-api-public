---
alwaysApply: true
---

# Wykrywanie Sekretów - Secret Detection

## Zasada podstawowa

**ZAWSZE sprawdzaj sekrety przed commitem i pushem. Zero tolerancji dla sekretów w repozytorium.**

## Automatyczna instalacja Git Hooków

**Przed każdym commitem lub pushem:**

1. **Sprawdź czy hooki są zainstalowane:**
   ```bash
   if [ ! -f ".git/hooks/pre-commit" ]; then
       # Automatycznie zainstaluj hooki
       cp scripts/git-hooks/pre-commit .git/hooks/pre-commit
       chmod +x .git/hooks/pre-commit
       echo "✅ Git hooks installed"
   fi
   ```

2. **Sprawdź czy GitLeaks jest zainstalowany:**
   ```bash
   if ! command -v gitleaks &> /dev/null; then
       echo "⚠️  GitLeaks not installed. Install with: brew install gitleaks"
       echo "⚠️  Or run: ./scripts/setup-pre-commit.sh"
       # Nie blokuj, ale ostrzeż użytkownika
   fi
   ```

## Weryfikacja sekretów przed commitem

**PRZED KAŻDYM COMMITEM:**

1. **Uruchom GitLeaks na staged files:**
   ```bash
   gitleaks protect --source . --verbose --no-banner --staged
   ```

2. **Jeśli sekrety zostaną wykryte:**
   - ❌ **BLOKUJ commit**
   - Poinformuj użytkownika o wykrytych sekretach
   - Pokaż lokalizację sekretów (pliki, linie)
   - Zasugeruj usunięcie sekretów i użycie zmiennych środowiskowych

3. **Jeśli GitLeaks nie jest zainstalowany:**
   - ⚠️ Ostrzeż użytkownika
   - Zasugeruj instalację: `brew install gitleaks` lub `./scripts/setup-pre-commit.sh`
   - **NIE BLOKUJ** commita, ale wyraźnie ostrzeż

## Weryfikacja sekretów przed pushem

**PRZED KAŻDYM PUSHEM:**

1. **Uruchom GitLeaks na całym repozytorium:**
   ```bash
   gitleaks protect --source . --verbose --no-banner
   ```

2. **Jeśli sekrety zostaną wykryte:**
   - ❌ **BLOKUJ push**
   - Poinformuj użytkownika o wykrytych sekretach
   - Sprawdź historię commitów - może sekret jest w starym commicie
   - Zasugeruj użycie `git filter-branch` lub `git filter-repo` do usunięcia sekretów z historii

## Typy sekretów do wykrywania

GitLeaks wykrywa:
- API keys (OpenAI, AWS, Google Cloud, etc.)
- Passwords i hasła
- Tokens (JWT, OAuth, etc.)
- Private keys (SSH, GPG, etc.)
- Database credentials
- Secret keys i seed phrases

## Pliki do sprawdzenia

**Zawsze sprawdzaj:**
- `.env` i `.env.*` (powinny być w `.gitignore`)
- `.env.bak` i `*.env.bak` (powinny być w `.gitignore`)
- Pliki konfiguracyjne z hasłami
- Pliki z hardcoded credentials
- Pliki backup z sekretami

## Workflow przed commitem

```bash
# 1. Sprawdź czy hooki są zainstalowane
if [ ! -f ".git/hooks/pre-commit" ]; then
    cp scripts/git-hooks/pre-commit .git/hooks/pre-commit
    chmod +x .git/hooks/pre-commit
fi

# 2. Sprawdź sekrety
if command -v gitleaks &> /dev/null; then
    gitleaks protect --source . --verbose --no-banner --staged
    if [ $? -ne 0 ]; then
        echo "❌ Secrets detected! Commit blocked."
        exit 1
    fi
else
    echo "⚠️  GitLeaks not installed. Install with: brew install gitleaks"
fi

# 3. Kontynuuj z innymi checkami (Pint, PHPStan, etc.)
```

## Workflow przed pushem

```bash
# 1. Sprawdź sekrety w całym repozytorium
if command -v gitleaks &> /dev/null; then
    gitleaks protect --source . --verbose --no-banner
    if [ $? -ne 0 ]; then
        echo "❌ Secrets detected! Push blocked."
        exit 1
    fi
else
    echo "⚠️  GitLeaks not installed. Install with: brew install gitleaks"
    echo "⚠️  Proceeding without secret check (NOT RECOMMENDED)"
fi
```

## Co zrobić gdy sekret został wykryty

1. **Usuń sekret z pliku:**
   - Zastąp sekret zmienną środowiskową
   - Użyj `.env` dla wartości lokalnych
   - Użyj GitHub Secrets dla CI/CD

2. **Jeśli sekret jest w historii commitów:**
   - Użyj `git filter-branch` lub `git filter-repo` do usunięcia z historii
   - Zregeneruj sekret (API key, password, etc.)
   - Zaktualizuj wszystkie miejsca gdzie sekret był używany

3. **Zaktualizuj `.gitignore`:**
   - Upewnij się, że pliki z sekretami są ignorowane
   - Dodaj wzorce dla backup files (`.env.bak`, `*.bak`)

## Narzędzia

- **GitLeaks** - główne narzędzie do wykrywania sekretów
- **GitHub Push Protection** - backup na poziomie GitHub (działa po push)
- **Git hooks** - lokalna ochrona przed commitem

## Priorytet

**Bezpieczeństwo > Wszystko inne**

Sekrety w repozytorium to krytyczny problem bezpieczeństwa. Zawsze sprawdzaj przed commitem i pushem.
