# GitLeaks Configuration for MovieMind API

title = "MovieMind API GitLeaks Configuration"

[extend]
useDefault = true

# Custom regex patterns
[extend.regexes]
movieMindApiKey = '''movie_mind_api_key\s*=\s*['"]?[a-zA-Z0-9]{32,}['"]?'''
openaiApiKey = '''openai_api_key\s*=\s*['"]?sk-[a-zA-Z0-9]{48}['"]?'''
postgresPassword = '''postgres_password\s*=\s*['"]?[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{}|;:,.<>?]{8,}['"]?'''

# Allowlist patterns
[extend.allowlist]
description = "Allowlist for false positives"

# Ignore specific commit with test API key
[[extend.allowlist.commits]]
commit = "5971c959dd4689baa97fe97c3a95506a00bd28ee"
reason = "Initial commit with test API key that was later changed"

[[extend.allowlist.regexes]]
regex = '''password\s*=\s*['"]?password['"]?'''
reason = "Default password placeholder"

[[extend.allowlist.regexes]]
regex = '''api_key\s*=\s*['"]?your-api-key-here['"]?'''
reason = "Example API key placeholder"

[[extend.allowlist.regexes]]
regex = '''OPENAI_API_KEY\s*=\s*['"]?<REPLACE_ME>['"]?'''
reason = "Environment variable placeholder"

[[extend.allowlist.regexes]]
regex = '''sk-test-[a-zA-Z0-9]{48}'''
reason = "OpenAI test API keys"

[[extend.allowlist.regexes]]
regex = '''moviemind:moviemind@db:5432/moviemind'''
reason = "Docker Compose example database URL"

[[extend.allowlist.regexes]]
regex = '''curl -H "X-API-Key: [^"]*"'''
reason = "cURL example with placeholder API key"

[[extend.allowlist.regexes]]
regex = '''OPENAI_API_KEY=sk-[a-zA-Z0-9]{48}'''
reason = "Example OpenAI API key in documentation"

[[extend.allowlist.regexes]]
regex = '''mm_[a-z0-9_]*_(not_real|test|example|fake|dummy|placeholder)[a-z0-9_]*'''
reason = "Test API keys with explicit fake markers"
caseInsensitive = true

[[extend.allowlist.regexes]]
regex = '''['"]mm_[a-z0-9]{20,}['"]'''
reason = "All test API keys in test files (any mm_ key with sufficient length)"
caseInsensitive = true

[[extend.allowlist.regexes]]
regex = '''\$key\s*=\s*['"]mm_[a-z0-9]{20,}['"]'''
reason = "Test API key variable assignments"
caseInsensitive = true

[[extend.allowlist.regexes]]
regex = '''\$plaintext\s*=\s*['"]mm_[a-z0-9]{20,}['"]'''
reason = "Test API key plaintext variable assignments"
caseInsensitive = true

[[extend.allowlist.regexes]]
regex = '''mm_abcdefghijklmnopqrstuvwxyz1234567890'''
reason = "Specific test API key from initial commit"
caseInsensitive = true

[[extend.allowlist.regexes]]
regex = '''mm_[a-z0-9]{30,}'''
reason = "All test API keys with mm_ prefix (30+ chars) in test files"
caseInsensitive = true

# Allowlist specific files
[[extend.allowlist.paths]]
path = '''README\.md'''
reason = "Documentation file with examples"

[[extend.allowlist.paths]]
path = '''\.env\.example'''
reason = "Environment template file"

[[extend.allowlist.paths]]
path = '''docker-compose\.yml'''
reason = "Docker Compose configuration"

[[extend.allowlist.paths]]
path = '''docs/.*'''
reason = "Documentation directory"

[[extend.allowlist.paths]]
path = '''docs/pre-commit-setup\.md'''
reason = "Pre-commit setup documentation with examples"

[[extend.allowlist.paths]]
path = '''api/tests/.*'''
reason = "Test files with fake API keys for testing"

# Custom rules
[[extend.rules]]
id = "movie-mind-api-key"
description = "MovieMind API Key"
regex = '''movie_mind_api_key\s*=\s*['"]?[a-zA-Z0-9]{32,}['"]?'''
tags = ["key", "api", "movie-mind"]
entropy = 3.5

[[extend.rules]]
id = "openai-api-key-detailed"
description = "OpenAI API Key (detailed pattern)"
regex = '''sk-[a-zA-Z0-9]{48}'''
tags = ["key", "api", "openai"]
entropy = 4.0

[[extend.rules]]
id = "postgres-connection-string"
description = "PostgreSQL Connection String with Password"
regex = '''postgresql://[^:]+:[^@]+@[^/]+/[^?]+'''
tags = ["database", "postgres", "connection"]
entropy = 3.0

[[extend.rules]]
id = "redis-password"
description = "Redis Password"
regex = '''redis://[^:]+:[^@]+@[^/]+'''
tags = ["database", "redis", "password"]
entropy = 3.0

# Severity levels
[extend.severity]
movie-mind-api-key = "high"
openai-api-key-detailed = "high"
postgres-connection-string = "medium"
redis-password = "medium"

# Disable generic-api-key rule for test files
[[extend.allowlist.rules]]
id = "generic-api-key"
reason = "Disable generic-api-key rule for test files to avoid false positives"
paths = ['''api/tests/.*''']